\documentclass[11pt]{article}
\usepackage[natbibapa]{apacite} % using natbib with APA-style citations; replaces \usepackage{natbib}
\usepackage{graphicx} % allows graphics
\usepackage{hyperref} % for adding color and clickable links to references

\usepackage{booktabs} % professional-quality tables

% configuration of {hyperref} package
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  citecolor=blue,
  urlcolor=blue
}

\usepackage{amsmath} % allows numbered equations, for one thing
\usepackage{authblk} % to add more authors
\usepackage{xfrac} % pretty fractions with \sfrac

\usepackage[a4paper, total={6in, 8in}]{geometry}

\usepackage[dvipsnames]{xcolor} % adds 68 named colors and the ability to define your own, but can cause trouble with beamer and tikz; tikz must be declared after this

\usepackage{mathpazo} % URW Palladio, from Palatino
\usepackage{microtype} % cleans up the kerning and hypenation
\usepackage[margin=15pt,font=small,labelfont={bf}]{caption} % cleans up the structure of the captions

\usepackage{tikz} % must be called after xcolor

\title{Reparameterizing the beta-binomial\linebreak distribution using $F_{ST}$}

\author[1]{Bret Alexander Beheim\thanks{Department of Human Behavior, Ecology and Culture, Max Planck Institute for Evolutionary Anthropology, Leipzig, Germany; \texttt{bret\_beheim@eva.mpg.de}}}
\date{} % using \date{} disables the date

\begin{document}

\maketitle % adds title or author (or both) and date (defaults to system date)

\section{Model}

The $F_{ST}$ statistic is the ratio of between-group to total variance on some quantitative measure in a group-structured population. It is useful to treat this ratio as an explicit parameter in the Beta-binomial distribution, both in simulation and estimation, though I have not seen this method described previously.

Let any group $j$ have stochastic mean value $x_j \sim \mathrm{Beta}(\alpha, \beta)$, and any individual $i$ within group $j$ have a discrete value $x_{ij}|x_j \sim \mathrm{Bernoulli}(x_j)$. Thus, each individual observation unconditionally follows a Beta-binomial($\alpha, \beta$) distribution, with expectation 
\[
  \mathrm{E}(x_{ij}) = \frac{\alpha}{\alpha + \beta} = \overline{x}.
\]
It is common in biology to reparameterize the Beta-binomial in terms of $\overline{x}$ and precision parameter $\theta = \alpha + \beta$.

From the definition of a Beta distribution's variance, the expected between-group variance is
\[
  \mathrm{var}(x_j) = \frac{\overline{x} (1 - \overline{x})}{\theta + 1},
\]
and because each individual $i$ in group $j$ follows a Bernoulli distribution with expectation $x_j$, the average within-group variance becomes is
\[
  \mathrm{E}(\mathrm{var}(x_j)) = \mathrm{E}(x_j(1-x_j)) = \mathrm{E}(x_j) - \mathrm{E}(x_j^2) = \overline{x} - \mathrm{var}(x_j) - \overline{x}^2
\]
\[
  = \frac{\overline{x} (1 - \overline{x}) \theta}{1 + \theta}
\]
Substituting these terms into the definition $F_{ST} = \mathrm{var}(x_j)/\mathrm{var}(x_{ij})$ gives
\[
  F_{ST} = (1 + \theta)^{-1}
\]
or 
\[
  \theta = (1 - F_{ST})/F_{ST}.
\]
Thus, the Beta-binomial distribution itself can be fully re-parameterized in terms of $\overline{x}$ and $F_{ST}$, which operate as independent dimensions.

\begin{figure}[t]
  \centering
  \resizebox{6in}{!}{%
    \input{figures/pieExamples.tex}
  }
  \caption{Six diversity scenarios for a metapopulation of nine groups (circles) characterized by a global mean $\overline{x}$ and $F_{ST}$. For some discrete individual trait with two types, $A$ (green) and $B$ (yellow), we compare metapopulation mean frequencies of $A$ at two levels, $\overline{x} \in \{0.1, 0.5\}$ and three between-total variance ratios, $F_{ST} \in \{0.1, 0.5, 0.9\}$.}
  \label{fig:pieExamples}
\end{figure}

\section{Use in Generative Simulation}

We can use the above formulation to create simulated metapopulation configurations with nearly-arbitrary $F_{ST}$ boundaries. For $m$ groups with $n$ individuals, there are $\binom{n + m}{m}$ possible configurations. Each can be generated by $mn$ draws from a Beta-binomial distribution. By setting $F_{ST}$ in this distribution, we can produce empirical populations whose Fst becomes arbitrarily close to this value as $mn$ increases. In the R language, an example might be:

\begin{verbatim}
rbetabinom <- function(m, n, mu, Fst) {
  theta <- (1 - Fst) / Fst
  p <- rbeta(m, mu * theta, (1 - mu) * theta)
  x <- rbinom(m, n, prob = p)
  return(x)
}
\end{verbatim}

\section{Use in Statistical Estimation}

In a frequentist analysis, a standard method of calculating $F_{ST}$ is to pull the $R^2$ from an ANOVA analysis or, equivalently, a linear regression of traits on group categories. The above method implies we can treat each outcome as a Beta-binomial draw with priors on x and Fst. In the Stan language, an example program might be written:

\begin{verbatim}

data {
  int<lower=1> m;
  int<lower=1> b;
  array[m] int<lower=0, upper=n> x;
}
parameters {
  real<lower=0, upper=1> mu;
  real<lower=0, upper=1> F;
}
transformed_parameters {
  real theta = (1 - F) / F
  real a = mu * theta;
  real b = mu * (1 - theta);
}
model {
  F ~ beta(3, 7)
  mu ~ beta(2, 2) 
  target += beta_binomial_lpmf(x | n, a, b)
}
\end{verbatim}

Statistical estimation applied to several examples of simulated data from known parameters shows close agreement in all cases (Figure X).

\section{Conclusion}

We have seen how $F_{ST}$ can be controlled and estimated on dichotomous traits in a Beta-binomial context. This method can aid $F_{ST}$ research in both generative simulation and empirical analyses.

\subsection*{Supplementary Information}

All code to produce figures is available at https://github.com/babeheim/beta-binomial-fst under a CC-BY-NC 4.0 software license.



\end{document}
